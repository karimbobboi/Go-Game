{"version":3,"file":"useDefaults-C2groUjC.js","sources":["../src/composables/useDefaults.ts"],"sourcesContent":["/* eslint-disable eqeqeq */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n// Utilities\nimport {\n  getCurrentInstance as _getCurrentInstance,\n  type ComponentInternalInstance,\n  computed,\n  inject,\n  type InjectionKey,\n  provide,\n  ref,\n  shallowRef,\n  type VNode,\n  watchEffect,\n} from 'vue'\nimport {defaultsKey} from '../utils/keys'\nimport type {BvnComponentProps} from '../types/BootstrapVueOptions'\n\n// Code here was taken from\n// https://github.com/vuetifyjs/vuetify/blob/8ed87310890e2b6c8ad2a626a02c17f9467cbb60/packages/vuetify/src/composables/defaults.ts#L138\n// Thanks to the Vuetify team. Vue does not make this easy\n\nfunction injectSelf<T>(key: InjectionKey<T> | string, vm?: ComponentInternalInstance): T | undefined\nfunction injectSelf(key: InjectionKey<any> | string, vm = getCurrentInstance('injectSelf')) {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  const {provides} = vm\n\n  if (provides && (key as string | symbol) in provides) {\n    // TS doesn't allow symbol as index type\n    return provides[key as string]\n  }\n  return undefined\n}\n\nfunction getCurrentInstance(name: string, message?: string) {\n  const vm = _getCurrentInstance()\n\n  if (!vm) {\n    throw new Error(`[Bvn] ${name} ${message || 'must be called from inside a setup function'}`)\n  }\n\n  return vm\n}\n\nconst toKebabCase = (str = '') =>\n  str\n    .replace(/[^a-z]/gi, '-')\n    .replace(/\\B([A-Z])/g, '-$1')\n    .toLowerCase()\nconst isObject = (obj: any): obj is Record<string, any> =>\n  obj !== null && typeof obj === 'object' && !Array.isArray(obj)\n\nfunction mergeDeep(\n  source: Record<string, any> = {},\n  target: Record<string, any> = {},\n  arrayFn?: (a: unknown[], b: unknown[]) => unknown[]\n) {\n  const out: Record<string, any> = {}\n\n  for (const key in source) {\n    out[key] = source[key]\n  }\n\n  for (const key in target) {\n    const sourceProperty = source[key]\n    const targetProperty = target[key]\n\n    // Only continue deep merging if\n    // both properties are objects\n    if (isObject(sourceProperty) && isObject(targetProperty)) {\n      out[key] = mergeDeep(sourceProperty, targetProperty, arrayFn)\n\n      continue\n    }\n\n    if (Array.isArray(sourceProperty) && Array.isArray(targetProperty) && arrayFn) {\n      out[key] = arrayFn(sourceProperty, targetProperty)\n\n      continue\n    }\n\n    out[key] = targetProperty\n  }\n\n  return out\n}\n\nconst propIsDefined = (vnode: VNode, prop: string) =>\n  typeof vnode.props?.[prop] !== 'undefined' ||\n  typeof vnode.props?.[toKebabCase(prop)] !== 'undefined'\n\nfunction internalUseDefaults(props: Record<string, any> = {}, name?: string) {\n  const defaults = inject(defaultsKey, ref({}))\n  const vm = getCurrentInstance('useDefaults')\n\n  name = name ?? vm.type.name ?? vm.type.__name\n  if (!name) {\n    // Should never happen\n    throw new Error('[Bvn] Could not determine component name')\n  }\n\n  const componentDefaults = computed(() => (defaults.value as any)?.[props._as ?? name])\n  const _props = new Proxy(props, {\n    get(target, prop) {\n      const propValue = Reflect.get(target, prop)\n      if (prop === 'class' || prop === 'style') {\n        return [componentDefaults.value?.[prop], propValue].filter((v) => v != null)\n      } else if (typeof prop === 'string' && !propIsDefined(vm.vnode, prop)) {\n        return (\n          componentDefaults.value?.[prop] ?? (defaults.value as any)?.global?.[prop] ?? propValue\n        )\n      }\n      return propValue\n    },\n  })\n\n  const _subcomponentDefaults = shallowRef()\n  watchEffect(() => {\n    if (componentDefaults.value) {\n      const subComponents = Object.entries(componentDefaults.value).filter(([key]) =>\n        key.startsWith(key[0].toUpperCase())\n      )\n      _subcomponentDefaults.value = subComponents.length\n        ? Object.fromEntries(subComponents)\n        : undefined\n    } else {\n      _subcomponentDefaults.value = undefined\n    }\n  })\n\n  function provideSubDefaults() {\n    const injected = injectSelf(defaultsKey, vm)\n    provide(\n      defaultsKey,\n      computed(() =>\n        _subcomponentDefaults.value\n          ? mergeDeep(injected?.value ?? {}, _subcomponentDefaults.value)\n          : injected?.value\n      ) as any\n    )\n  }\n\n  return {props: _props, provideSubDefaults}\n}\n\nexport function useDefaults<T extends Record<string, any>>(\n  props: T,\n  name: keyof BvnComponentProps\n): T {\n  const {props: _props, provideSubDefaults} = internalUseDefaults(props, name)\n  provideSubDefaults()\n  return _props as T\n}\n"],"names":["getCurrentInstance","name","message","vm","_getCurrentInstance","Error","isObject","obj","Array","isArray","mergeDeep","source","target","arrayFn","out","key","sourceProperty","targetProperty","propIsDefined","vnode","prop","_a","props","_b","str","replace","toLowerCase","toKebabCase","internalUseDefaults","defaults","inject","defaultsKey","ref","type","__name","componentDefaults","computed","value","_as","_props","Proxy","get","propValue","Reflect","filter","v","_d","_c","global","_subcomponentDefaults","shallowRef","watchEffect","subComponents","Object","entries","startsWith","toUpperCase","length","fromEntries","provideSubDefaults","injected","provides","injectSelf","vue","provide"],"mappings":"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"}