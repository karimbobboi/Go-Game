{"version":3,"file":"index.umd.js","sources":["../../../../src/plugins/modalController/index.ts"],"sourcesContent":["import {markRaw, type Plugin, ref, toRef, watch} from 'vue'\nimport {modalControllerPluginKey} from '../../utils/keys'\nimport type {\n  ModalOrchestratorMapValue,\n  ModalOrchestratorShowParam,\n} from '../../types/ComponentOrchestratorTypes'\n\nexport const modalControllerPlugin: Plugin = {\n  install(app) {\n    const modals = ref(new Map<symbol, ModalOrchestratorMapValue>())\n\n    const buildPromise = (): {\n      value: Promise<boolean | null>\n      resolve: (value: boolean | null) => void\n    } => {\n      let resolveFunc: (value: boolean | null) => void = () => {\n        /* empty */\n      }\n\n      const promise = new Promise<boolean | null>((resolve) => {\n        resolveFunc = resolve\n      })\n\n      return {\n        value: promise,\n        resolve: resolveFunc,\n      }\n    }\n\n    const buildPrereqs = () => [buildPromise(), Symbol(), true] as const\n\n    const show = (obj: ModalOrchestratorShowParam = {}) => {\n      const resolvedProps = toRef(obj.props)\n\n      const [_promise, _self, _modelValue] = buildPrereqs()\n\n      modals.value.set(_self, {\n        component: !obj.component ? undefined : markRaw(obj.component),\n        props: {...resolvedProps.value, _isConfirm: false, _promise, _modelValue},\n      })\n\n      watch(resolvedProps, (newValue) => {\n        const previous = modals.value.get(_self)\n        if (!previous) return\n        modals.value.set(_self, {\n          component: !obj.component ? undefined : markRaw(obj.component),\n          props: {...previous.props, ...newValue},\n        })\n      })\n\n      return _promise.value\n    }\n\n    const confirm = (obj: ModalOrchestratorShowParam = {}) => {\n      const resolvedProps = toRef(obj.props)\n\n      const [_promise, _self, _modelValue] = buildPrereqs()\n\n      modals.value.set(_self, {\n        component: !obj.component ? undefined : markRaw(obj.component),\n        props: {...resolvedProps.value, _isConfirm: true, _promise, _modelValue},\n      })\n\n      watch(resolvedProps, (newValue) => {\n        const previous = modals.value.get(_self)\n        if (!previous) return\n        modals.value.set(_self, {\n          component: !obj.component ? undefined : markRaw(obj.component),\n          props: {...previous.props, ...newValue},\n        })\n      })\n\n      return _promise.value\n    }\n\n    const leave = (self: symbol) => {\n      const modal = modals.value.get(self)\n      if (!modal?.props) return\n      modal.props = {\n        ...modal.props,\n        _modelValue: false,\n      }\n    }\n\n    const remove = (self: symbol) => {\n      modals.value.delete(self)\n    }\n\n    app.provide(modalControllerPluginKey, {\n      modals,\n      remove,\n      show,\n      confirm,\n      leave,\n    })\n  },\n}\n"],"names":["modalControllerPlugin","install","app","modals","ref","Map","buildPromise","resolveFunc","value","Promise","resolve","buildPrereqs","Symbol","provide","modalControllerPluginKey","remove","self","delete","show","obj","resolvedProps","toRef","props","_promise","_self","_modelValue","set","component","markRaw","_isConfirm","newValue","previous","get","confirm","leave","modal"],"mappings":"8IAOaA,EAAgC,CAC3C,OAAAC,CAAQC,GACN,MAAMC,EAASC,EAAAA,IAAQ,IAAAC,KAEjBC,EAAe,KAInB,IAAIC,EAA+C,OAQ5C,MAAA,CACLC,MALc,IAAIC,SAAyBC,IAC7BH,EAAAG,CAAA,IAKdA,QAASH,EAAA,EAIPI,EAAe,IAAM,CAACL,IAAgBM,UAAU,GA2DlDV,EAAAW,QAAQC,2BAA0B,CACpCX,SACAY,OANcC,IACPb,EAAAK,MAAMS,OAAOD,EAAI,EAMxBE,KA5DW,CAACC,EAAkC,MACxC,MAAAC,EAAgBC,EAAAA,MAAMF,EAAIG,QAEzBC,EAAUC,EAAOC,GAAed,IAgBvC,OAdOR,EAAAK,MAAMkB,IAAIF,EAAO,CACtBG,UAAYR,EAAIQ,UAAwBC,EAAAA,QAAQT,EAAIQ,gBAAxB,EAC5BL,MAAO,IAAIF,EAAcZ,MAAOqB,YAAY,EAAON,WAAUE,yBAGzDL,GAAgBU,IACpB,MAAMC,EAAW5B,EAAOK,MAAMwB,IAAIR,GAC7BO,GACE5B,EAAAK,MAAMkB,IAAIF,EAAO,CACtBG,UAAYR,EAAIQ,UAAwBC,EAAAA,QAAQT,EAAIQ,gBAAxB,EAC5BL,MAAO,IAAIS,EAAST,SAAUQ,IAC/B,IAGIP,EAASf,KAAA,EA0ChByB,QAvCc,CAACd,EAAkC,MAC3C,MAAAC,EAAgBC,EAAAA,MAAMF,EAAIG,QAEzBC,EAAUC,EAAOC,GAAed,IAgBvC,OAdOR,EAAAK,MAAMkB,IAAIF,EAAO,CACtBG,UAAYR,EAAIQ,UAAwBC,EAAAA,QAAQT,EAAIQ,gBAAxB,EAC5BL,MAAO,IAAIF,EAAcZ,MAAOqB,YAAY,EAAMN,WAAUE,yBAGxDL,GAAgBU,IACpB,MAAMC,EAAW5B,EAAOK,MAAMwB,IAAIR,GAC7BO,GACE5B,EAAAK,MAAMkB,IAAIF,EAAO,CACtBG,UAAYR,EAAIQ,UAAwBC,EAAAA,QAAQT,EAAIQ,gBAAxB,EAC5BL,MAAO,IAAIS,EAAST,SAAUQ,IAC/B,IAGIP,EAASf,KAAA,EAqBhB0B,MAlBalB,IACb,MAAMmB,EAAQhC,EAAOK,MAAMwB,IAAIhB,UAC1BmB,WAAOb,SACZa,EAAMb,MAAQ,IACTa,EAAMb,MACTG,aAAa,GAAA,GAenB"}