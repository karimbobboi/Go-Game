{"version":3,"file":"BCollapse.vue_vue_type_script_setup_true_lang-BFjLbbnW.js","sources":["../src/components/BCollapse/BCollapse.vue"],"sourcesContent":["<template>\n  <slot name=\"header\" v-bind=\"sharedSlots\" />\n  <component\n    :is=\"props.tag\"\n    :id=\"computedId\"\n    ref=\"element\"\n    class=\"collapse\"\n    :class=\"computedClasses\"\n    :is-nav=\"props.isNav\"\n    v-bind=\"$attrs\"\n  >\n    <slot v-bind=\"sharedSlots\" />\n  </component>\n  <slot name=\"footer\" v-bind=\"sharedSlots\" />\n</template>\n\n<script setup lang=\"ts\">\nimport {computed, nextTick, onMounted, provide, readonly, ref, toRef, watch} from 'vue'\nimport {useDefaults} from '../../composables/useDefaults'\nimport {useId} from '../../composables/useId'\nimport {useEventListener} from '@vueuse/core'\nimport {collapseInjectionKey} from '../../utils/keys'\nimport type {BCollapseProps} from '../../types/ComponentProps'\nimport {BvTriggerableEvent} from '../../utils'\nimport {getTransitionDelay} from '../../utils/dom'\n\ndefineOptions({\n  inheritAttrs: false,\n})\n\nconst _props = withDefaults(defineProps<Omit<BCollapseProps, 'modelValue'>>(), {\n  horizontal: false,\n  id: undefined,\n  isNav: false,\n  skipAnimation: false,\n  tag: 'div',\n  toggle: false,\n  visible: false,\n})\n\nconst props = useDefaults(_props, 'BCollapse')\n\nconst emit = defineEmits<{\n  'hidden': []\n  'hide': [value: BvTriggerableEvent]\n  'hide-prevented': []\n  'show': [value: BvTriggerableEvent]\n  'show-prevented': []\n  'shown': []\n}>()\n\ntype SharedSlotsData = {\n  hide: () => void\n  id: string\n  show: () => void\n  toggle: () => void\n  visible: boolean\n}\n\ndefineSlots<{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  default?: (props: SharedSlotsData) => any\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  footer?: (props: SharedSlotsData) => any\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  header?: (props: SharedSlotsData) => any\n}>()\n\nconst buildTriggerableEvent = (\n  type: string,\n  opts: Readonly<Partial<BvTriggerableEvent>> = {}\n): BvTriggerableEvent =>\n  new BvTriggerableEvent(type, {\n    cancelable: false,\n    target: element.value || null,\n    relatedTarget: null,\n    trigger: null,\n    ...opts,\n    componentId: computedId.value,\n  })\n\nconst modelValue = defineModel<Exclude<BCollapseProps['modelValue'], undefined>>({\n  default: false,\n})\n\nconst computedId = useId(() => props.id, 'collapse')\n\nconst element = ref<HTMLElement | null>(null)\nconst isCollapsing = ref(false)\nconst showRef = ref(modelValue.value)\n\nconst computedClasses = computed(() => ({\n  'show': showRef.value,\n  'navbar-collapse': props.isNav,\n  'collapsing': isCollapsing.value,\n  'closing': showRef.value && !modelValue.value,\n  'collapse-horizontal': props.horizontal,\n}))\n\nconst hide = () => {\n  modelValue.value = false\n}\nconst show = () => {\n  modelValue.value = true\n}\nconst toggleFn = () => {\n  modelValue.value = !modelValue.value\n}\n\nconst sharedSlots = computed<SharedSlotsData>(() => ({\n  toggle: toggleFn,\n  show,\n  hide,\n  id: computedId.value,\n  visible: modelValue.value,\n}))\n\nlet revealTimeout: ReturnType<typeof setTimeout> | undefined\nlet hideTimeout: ReturnType<typeof setTimeout> | undefined\nlet _skipAnimation = props.skipAnimation\n\nconst reveal = () => {\n  const event = buildTriggerableEvent('show', {cancelable: true})\n  emit('show', event)\n  if (event.defaultPrevented) {\n    emit('show-prevented')\n    return\n  }\n  clearTimeout(hideTimeout)\n  clearTimeout(revealTimeout)\n  showRef.value = true\n  if (_skipAnimation) return\n  isCollapsing.value = true\n  nextTick(() => {\n    if (element.value === null) return\n    if (props.horizontal) {\n      element.value.style.width = `${element.value.scrollWidth}px`\n    } else {\n      element.value.style.height = `${element.value.scrollHeight}px`\n    }\n    revealTimeout = setTimeout(() => {\n      isCollapsing.value = false\n      emit('shown')\n      if (element.value === null) return\n      element.value.style.height = ''\n      element.value.style.width = ''\n    }, getTransitionDelay(element.value))\n  })\n}\n\nconst hideFn = () => {\n  const event = buildTriggerableEvent('hide', {cancelable: true})\n  emit('hide', event)\n  if (event.defaultPrevented) {\n    emit('hide-prevented')\n    return\n  }\n  clearTimeout(revealTimeout)\n  clearTimeout(hideTimeout)\n  if (element.value === null) return\n  if (_skipAnimation) {\n    showRef.value = false\n    return\n  }\n  if (isCollapsing.value) {\n    element.value.style.height = ``\n    element.value.style.width = ``\n    // return\n  } else {\n    if (props.horizontal) {\n      element.value.style.width = `${element.value.scrollWidth}px`\n    } else {\n      element.value.style.height = `${element.value.scrollHeight}px`\n    }\n  }\n  // element.value.style.height = `${element.value.scrollHeight}px`\n  element.value.offsetHeight // force reflow\n  isCollapsing.value = true\n  nextTick(() => {\n    if (element.value === null) return\n    element.value.style.height = ``\n    element.value.style.width = ``\n    hideTimeout = setTimeout(() => {\n      showRef.value = false\n      isCollapsing.value = false\n      emit('hidden')\n    }, getTransitionDelay(element.value))\n  })\n}\n\nwatch(modelValue, () => {\n  modelValue.value ? reveal() : hideFn()\n})\n\nonMounted(() => {\n  if (element.value === null) return\n  if (!modelValue.value && props.toggle) {\n    nextTick(() => {\n      modelValue.value = true\n    })\n  }\n})\n\nwatch(\n  () => props.skipAnimation,\n  (newval) => {\n    _skipAnimation = newval\n  }\n)\n\nif (props.visible) {\n  _skipAnimation = true\n  modelValue.value = true\n  nextTick(() => {\n    _skipAnimation = props.skipAnimation\n  })\n}\n\nwatch(\n  () => props.visible,\n  (newval) => {\n    _skipAnimation = true\n    newval ? show() : hide()\n    nextTick(() => {\n      _skipAnimation = props.skipAnimation\n    })\n  }\n)\n\nuseEventListener(element, 'bv-toggle', () => {\n  modelValue.value = !modelValue.value\n})\n\ndefineExpose({\n  hide,\n  isNav: props.isNav,\n  show,\n  toggle: toggleFn,\n  visible: readonly(showRef),\n})\n\nprovide(collapseInjectionKey, {\n  id: computedId,\n  hide,\n  show,\n  toggle: toggleFn,\n  visible: readonly(showRef),\n  isNav: toRef(() => props.isNav),\n})\n</script>\n"],"names":["_props","__props","props","useDefaults","emit","__emit","buildTriggerableEvent","type","opts","BvTriggerableEvent","cancelable","target","element","value","relatedTarget","trigger","componentId","computedId","modelValue","_useModel","useId","id","ref","isCollapsing","showRef","computedClasses","computed","show","isNav","collapsing","closing","horizontal","hide","toggleFn","sharedSlots","toggle","visible","revealTimeout","hideTimeout","_skipAnimation","skipAnimation","vue","watch","event","defaultPrevented","clearTimeout","nextTick","style","width","scrollWidth","height","scrollHeight","setTimeout","getTransitionDelay","reveal","offsetHeight","hideFn","onMounted","newval","__expose","readonly","provide","collapseInjectionKey","toRef"],"mappings":"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"}